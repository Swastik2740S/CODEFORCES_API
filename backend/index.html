<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Codeforces Full Dashboard Prototype</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  body {
    margin: 0;
    font-family: Inter, Arial, sans-serif;
    background: #0f172a;
    color: #e5e7eb;
  }

  header {
    padding: 20px;
    text-align: center;
    font-size: 28px;
    font-weight: bold;
    background: #020617;
  }

  .search {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 20px;
  }

  input {
    padding: 10px;
    border-radius: 6px;
    border: none;
    width: 240px;
  }

  button {
    padding: 10px 18px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    background: #22c55e;
    font-weight: bold;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 15px;
    padding: 20px;
  }

  .card {
    background: #020617;
    border-radius: 10px;
    padding: 15px;
    animation: fadeUp .5s ease;
  }

  h3 {
    margin-top: 0;
    color: #38bdf8;
  }

  table {
    width: 100%;
    font-size: 13px;
    border-collapse: collapse;
  }

  td, th {
    padding: 6px;
    border-bottom: 1px solid #334155;
  }

  canvas {
    background: white;
    border-radius: 10px;
    padding: 10px;
  }

  @keyframes fadeUp {
    from {opacity:0; transform: translateY(15px);}
    to {opacity:1; transform: translateY(0);}
  }
</style>
</head>

<body>

<header>üöÄ Codeforces Full Dashboard Prototype</header>

<div class="search">
  <input id="handle" placeholder="Enter Codeforces handle">
  <button onclick="loadAll()">Load Dashboard</button>
</div>

<div id="dashboard"></div>

<script>
let ratingChart;

async function loadAll() {
  const handle = document.getElementById("handle").value.trim();
  if (!handle) return alert("Enter handle");

  document.getElementById("dashboard").innerHTML = "Loading...";

  const [userInfo, rating, submissions, contests, problems] =
    await Promise.all([
      fetchJSON(`https://codeforces.com/api/user.info?handles=${handle}`),
      fetchJSON(`https://codeforces.com/api/user.rating?handle=${handle}`),
      fetchJSON(`https://codeforces.com/api/user.status?handle=${handle}&count=10`),
      fetchJSON(`https://codeforces.com/api/contest.list`),
      fetchJSON(`https://codeforces.com/api/problemset.problems`)
    ]);

  const user = userInfo.result[0];

  renderDashboard(user, rating.result, submissions.result, contests.result, problems.result);
}

async function fetchJSON(url) {
  const res = await fetch(url);
  const data = await res.json();
  if (data.status !== "OK") throw new Error(data.comment);
  return data;
}

function renderDashboard(user, rating, subs, contests, problems) {
  const dash = document.getElementById("dashboard");

  dash.innerHTML = `
    <div class="grid">
      <div class="card">
        <h3>üë§ Profile</h3>
        <p><b>${user.handle}</b></p>
        <p>${user.rank}</p>
        <p>Rating: ${user.rating ?? "Unrated"}</p>
        <p>Max: ${user.maxRating}</p>
      </div>

      <div class="card">
        <h3>üìä Rating History</h3>
        <canvas id="chart"></canvas>
      </div>

      <div class="card">
        <h3>üìù Recent Submissions</h3>
        <table>
          ${subs.map(s => `
            <tr>
              <td>${s.problem.name}</td>
              <td>${s.verdict}</td>
            </tr>
          `).join("")}
        </table>
      </div>

      <div class="card">
        <h3>üèÜ Contests</h3>
        <p>Total: ${contests.length}</p>
        <p>Upcoming: ${contests.filter(c => c.phase === "BEFORE").length}</p>
      </div>

      <div class="card">
        <h3>üìò Problems</h3>
        <p>Total problems: ${problems.problems.length}</p>
        <p>Unique tags: ${new Set(problems.problems.flatMap(p => p.tags)).size}</p>
      </div>
    </div>
  `;

  drawChart(rating);
}

function drawChart(rating) {
  const ctx = document.getElementById("chart");

  if (ratingChart) ratingChart.destroy();

  ratingChart = new Chart(ctx, {
    type: "line",
    data: {
      labels: rating.map(r => r.contestName),
      datasets: [{
        label: "Rating",
        data: rating.map(r => r.newRating),
        borderColor: "#22c55e",
        tension: 0.3
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: { x: { display: false } }
    }
  });
}
</script>

</body>
</html>
